name: Build Android App (APK/AAB)  

on:  
  push:  
    branches:  
      - main  
      - master  
  pull_request:  
    branches:  
      - main  
      - master  
  workflow_dispatch:  

env:  
  BUILD_NUMBER: 1  
  BUILD_VERSION: 1.0.0  
  PYTHON_VERSION: 3.12.2  
  FLUTTER_VERSION: 3.22.2  

jobs:  
  build-apk:  
    runs-on: ubuntu-latest  

    steps:  
    - name: Checkout code  
      uses: actions/checkout@v4  

    - name: Setup Python  
      uses: actions/setup-python@v5  
      with:  
        python-version: ${{ env.PYTHON_VERSION }}  

    - name: Install Python Dependencies  
      run: |  
        python -m pip install --upgrade pip  
        pip install -r requirements.txt  

    - name: Setup Java JDK  
      uses: actions/setup-java@v4.2.1  
      with:  
        distribution: 'temurin'  
        java-version: '21'  

    - name: Flet Build APK  
      run: |  
        flet build apk --verbose --build-number=$BUILD_NUMBER --build-version=$BUILD_VERSION  

    - name: Flet Build AAB  
      run: |  
        flet build aab --verbose --build-number=$BUILD_NUMBER --build-version=$BUILD_VERSION  

    - name: Upload APK Artifact  
      uses: actions/upload-artifact@v4.3.4  
      with:  
        name: apk-build-artifact  
        path: build/apk  
        if-no-files-found: warn  
        overwrite: false  

    - name: Upload AAB Artifact  
      uses: actions/upload-artifact@v4.3.4  
      with:  
        name: aab-build-artifact  
        path: build/aab  
        if-no-files-found: warn  
        overwrite: false
